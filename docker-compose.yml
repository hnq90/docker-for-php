version: "3"
services:
  # mysql 5.7.x
  db:
    restart: always
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: ro0tpass
      MYSQL_DATABASE:      homestead
      MYSQL_USER:          homestead
      MYSQL_PASSWORD:      secret
    volumes:
      - ./storage/database:/var/lib/mysql
      - ./storage/logs:/var/log/mysql

  # php-fpm 7.0.x
  php7:
    restart: always
    build: ./php7.0-fpm
    environment:
      DEBUG: 1
      SSH_AUTH_SOCK: /ssh-agent
    volumes:
      - $SSH_AUTH_SOCK:/ssh-agent # Forward local machine SSH key to docker
      - ./php7.0-fpm/php.ini:/etc/php.ini
      - ./php7.0-fpm/php-fpm.conf:/usr/local/etc/php-fpm.conf
      - ./storage/logs:/var/log/php-fpm
      - .:/app

    links:
      - db

  # nginx 1.10.x
  web:
    image: nginx:stable-alpine
    ports:
      - "8080:80"
    volumes:
      - ./storage/logs:/var/log/nginx
      - ./nginx/site.conf:/etc/nginx/conf.d/site.conf:ro
      - .:/app
    links:
      - php7
